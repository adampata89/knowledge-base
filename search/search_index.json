{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":[" "]},"docs":[{"location":"","title":"Witaj w bazie wiedzy!","text":"<p>Niniejsza baza wiedzy powsta\u0142a w czasie pokonywania \u015bcie\u017cki kariery w IT. Zawiera ona wiedz\u0119 zdobyt\u0105 podczas nauki, praktyczne porady oraz dzia\u0142aj\u0105ce rozwi\u0105zania poszczeg\u00f3lnych zagadnie\u0144.</p>"},{"location":"di/constructor/","title":"Konfigurowanie argument\u00f3w konstruktora","text":"<p>Argumenty konstruktora klas mo\u017cna skonfigurowa\u0107 w pliku <code>di.xml</code> w w\u0119\u017ale <code>arguments</code>. Argumenty te mog\u0105 zosta\u0107 wprowadzone do klasy przez mened\u017cera obiekt\u00f3w podczas tworzenia. Nale\u017cy pami\u0119ta\u0107, \u017ce nazwa argumentu konfigurowanego w pliku XML musi odpowiada\u0107 nazwie parametru znajduj\u0105cego si\u0119 w konstruktorze konfigurowanej klasy.</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n        &lt;type name=\"Magento\\Core\\Model\\Session\"&gt;\n            &lt;arguments&gt;\n                &lt;argument name=\"sessionName\" xsi:type=\"string\"&gt;adminhtml&lt;/argument&gt;\n            &lt;/arguments&gt;\n        &lt;/type&gt;\n    &lt;/config&gt;\n</code></pre>"},{"location":"di/constructor/#typy-argumentow","title":"Typy argument\u00f3w","text":""},{"location":"di/constructor/#object","title":"object","text":"<pre><code>    &lt;argument xsi:type=\"object\"&gt;{typeName}&lt;/argument&gt;\n</code></pre> <pre><code>    &lt;argument xsi:type=\"object\" shared=\"{shared}\"&gt;{typeName}&lt;/argument&gt;\n</code></pre> <p>Tworzy instancj\u0119 typu typeName i przekazuje j\u0105 jako argument. Mo\u017cesz przekaza\u0107 dowoln\u0105 nazw\u0119 klasy, nazw\u0119 interfejsu lub typ wirtualny jako typeName.</p> <p>Styl \u017cycia utworzonej instancji jest zdefiniowany, gdy ustawisz w\u0142a\u015bciwo\u015b\u0107 shared. Wi\u0119cej szczeg\u00f3\u0142\u00f3w znajdziesz tutaj.</p>"},{"location":"di/constructor/#string","title":"string","text":"<pre><code>    &lt;argument xsi:type=\"string\"&gt;anyStringValue&lt;/argument&gt;\n</code></pre>"},{"location":"di/constructor/#boolean","title":"boolean","text":"<pre><code>    &lt;argument xsi:type=\"boolean\"&gt;true/false&lt;/argument&gt;\n</code></pre> <p>Aplikacja konwertuje dowoln\u0105 warto\u015b\u0107 dla tego w\u0119z\u0142a argumentu na warto\u015b\u0107 logiczn\u0105 wed\u0142ug poni\u017cszej tabeli:</p> Input type Data Bolean value Boolean true true Boolean false false String 'true' true String 'false' false String '1' true String '0' false Integer 1 true Integer 0 false"},{"location":"di/constructor/#number","title":"number","text":"<pre><code>    &lt;argument xsi:type=\"number\"&gt;{numValue}&lt;/argument&gt;\n</code></pre> <p>Akceptowalne warto\u015bci dla tego typu to liczby ca\u0142kowite, zmiennoprzecinkowe lub ci\u0105gi znak\u00f3w numerycznych.</p>"},{"location":"di/constructor/#init_parameter","title":"init_parameter","text":"<pre><code>    &lt;argument xsi:type=\"init_parameter\"&gt;{Constant::NAME}&lt;/argument&gt;\n</code></pre>"},{"location":"di/constructor/#const","title":"const","text":"<pre><code>    &lt;argument xsi:type=\"const\"&gt;{Constant::NAME}&lt;/argument&gt;\n</code></pre>"},{"location":"di/constructor/#null","title":"null","text":"<pre><code>    &lt;argument xsi:type=\"null\"/&gt;\n</code></pre>"},{"location":"di/constructor/#array","title":"array","text":"<pre><code>    &lt;argument xsi:type=\"array\"&gt;\n        &lt;item name=\"someKey\" xsi:type=\"&lt;type&gt;\"&gt;someVal&lt;/item&gt;\n    &lt;/argument&gt;\n</code></pre>"},{"location":"di/constructor/#przykady","title":"Przyk\u0142ady","text":"<p>Przyk\u0142ady wstrzykiwania argument\u00f3w konstruktora:</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n        &lt;type name=\"Magento\\Example\\Type\"&gt;\n            &lt;arguments&gt;\n                &lt;!-- Pass simple string --&gt;\n                &lt;argument name=\"stringParam\" xsi:type=\"string\"&gt;someStringValue&lt;/argument&gt;\n\n                &lt;!-- Pass instance of Magento\\Some\\Type --&gt;\n                &lt;argument name=\"instanceParam\" xsi:type=\"object\"&gt;Magento\\Some\\Type&lt;/argument&gt;\n\n                &lt;!-- Pass true --&gt;\n                &lt;argument name=\"boolParam\" xsi:type=\"boolean\"&gt;1&lt;/argument&gt;\n\n                &lt;!-- Pass 1 --&gt;\n                &lt;argument name=\"intParam\" xsi:type=\"number\"&gt;1&lt;/argument&gt;\n\n                &lt;!-- Pass application init argument, named by constant value --&gt;\n                &lt;argument name=\"globalInitParam\" xsi:type=\"init_parameter\"&gt;Magento\\Some\\Class::SOME_CONSTANT&lt;/argument&gt;\n\n                &lt;!-- Pass constant value --&gt;\n                &lt;argument name=\"constantParam\" xsi:type=\"const\"&gt;Magento\\Some\\Class::SOME_CONSTANT&lt;/argument&gt;\n\n                &lt;!-- Pass null value --&gt;\n                &lt;argument name=\"optionalParam\" xsi:type=\"null\"/&gt;\n\n                &lt;!-- Pass array --&gt;\n                &lt;argument name=\"arrayParam\" xsi:type=\"array\"&gt;\n\n                    &lt;!-- First element is value of constant --&gt;\n                    &lt;item name=\"firstElem\" xsi:type=\"const\"&gt;Magento\\Some\\Class::SOME_CONSTANT&lt;/item&gt;\n\n                    &lt;!-- Second element is null --&gt;\n                    &lt;item name=\"secondElem\" xsi:type=\"null\"/&gt;\n\n                    &lt;!-- Third element is a subarray --&gt;\n                    &lt;item name=\"thirdElem\" xsi:type=\"array\"&gt;\n\n                        &lt;!-- Subarray contains scalar value --&gt;\n                        &lt;item name=\"scalarValue\" xsi:type=\"string\"&gt;ScalarValue&lt;/item&gt;\n\n                        &lt;!-- and application init argument --&gt;\n                        &lt;item name=\"globalArgument \" xsi:type=\"init_parameter\"&gt;Magento\\Some\\Class::SOME_CONSTANT&lt;/item&gt;\n                    &lt;/item&gt;\n                &lt;/argument&gt;\n            &lt;/arguments&gt;\n        &lt;/type&gt;\n    &lt;/config&gt;\n</code></pre> <p>Przyk\u0142ad wykorzystania przy tworzeniu w\u0142asnych operacji bulkowych</p> <pre><code>    &lt;type name=\"Magento\\Framework\\MessageQueue\\MergerFactory\"&gt;\n        &lt;arguments&gt;\n            &lt;argument name=\"mergers\" xsi:type=\"array\"&gt;\n                &lt;item name=\"&lt;your_consumer_name&gt;\" xsi:type=\"string\"&gt;&lt;Merger_Class&gt;&lt;/item&gt;\n            &lt;/argument&gt;\n        &lt;/arguments&gt;\n    &lt;/type&gt;\n</code></pre>"},{"location":"di/constructor/#implementacja-interfejsow","title":"Implementacja interfejs\u00f3w","text":"<p>Mened\u017cer obiekt\u00f3w u\u017cywa mapowa\u0144 abstrakcji-implementacji, gdy podpis konstruktora klasy \u017c\u0105da obiektu przez jej interfejs. Mened\u017cer obiekt\u00f3w u\u017cywa tych mapowa\u0144, aby okre\u015bli\u0107, jaka jest domy\u015blna implementacja tej klasy dla okre\u015blonego zakresu.</p> <p>W\u0119ze\u0142 <code>preference</code> okre\u015bla domy\u015bln\u0105 implementacj\u0119:</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n            &lt;preference for=\"Magento\\Framework\\UrlInterface\"\n                        type=\"Magento\\Framework\\Url\" /&gt;\n    &lt;/config&gt;\n</code></pre>"},{"location":"di/constructor/#nadpisywanie-preferencji","title":"Nadpisywanie preferencji","text":"<p>Je\u015bli chcesz zast\u0105pi\u0107 metod\u0119 publiczn\u0105 lub chronion\u0105 z klasy podstawowej, u\u017cyj w\u0119z\u0142a <code>preference</code> z pliku <code>di.xml</code>, aby to osi\u0105gn\u0105\u0107.</p> <p>Oto przyk\u0142ad zast\u0105pienia metody z pliku podstawowego:</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n            &lt;preference for=\"Magento\\Checkout\\Block\\Onepage\\Success\"\n                        type=\"ExampleCorp\\OverrideExample\\Block\\Onepage\\Success\" /&gt;\n\n    &lt;/config&gt;\n</code></pre> Uwaga <p>Magento zaleca u\u017cywanie plugin\u00f3w oraz event obserwer\u00f3w zamiast nadpisywania klas.</p>"},{"location":"di/constructor/#dziedziczenie-konfiguracji-parametrow","title":"Dziedziczenie konfiguracji parametr\u00f3w","text":"<p>Parametry skonfigurowane dla typu klasy przekazuj\u0105 jego konfiguracj\u0119 do klas potomnych. Ka\u017cdy potomek mo\u017ce zast\u0105pi\u0107 parametry skonfigurowane dla jego nadtypu; to znaczy klasa nadrz\u0119dna lub interfejs:</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n            &lt;type name=\"Magento\\Framework\\View\\Element\\Context\"&gt;\n                    &lt;arguments&gt;\n                            &lt;argument name=\"urlBuilder\" xsi:type=\"object\"&gt;Magento\\Framework\\Url&lt;/argument&gt;\n                    &lt;/arguments&gt;\n            &lt;/type&gt;\n\n            &lt;type name=\"Magento\\Backend\\Block\\Context\"&gt;\n                    &lt;arguments&gt;\n                            &lt;argument name=\"urlBuilder\" xsi:type=\"object\"&gt;Magento\\Backend\\Model\\Url&lt;/argument&gt;\n                    &lt;/arguments&gt;\n            &lt;/type&gt;\n\n    &lt;/config&gt;\n</code></pre> <p>W powy\u017cszym przyk\u0142adzie <code>Magento\\Backend\\Block\\Context</code> jest potomkiem <code>Magento\\Framework\\View\\Element\\Context</code>.</p> <p>Pierwszy wpis konfiguruje wszystkie instancje <code>Magento\\Framework\\View\\Element\\Context</code>, a tak\u017ce jego dzieci, aby przekaza\u0107 <code>Magento\\Framework\\Url</code> jako <code>$urlBuilder</code> w swoich konstruktorach.</p> <p>Drugi wpis zast\u0119puje to i konfiguruje wszystkie instancje <code>Magento\\Backend\\Block\\Context</code> tak, aby zamiast tego u\u017cywa\u0142y <code>Magento\\Backend\\Model\\Url</code> jako <code>$urlBuilder</code>.</p>"},{"location":"di/di_info/","title":"Informacje o konfiguracji DI","text":"<p>U\u017cyj polecenia <code>dev:di:info</code>, aby pobra\u0107 informacje o konfiguracji wstrzykiwania zale\u017cno\u015bci dla klasy. Poni\u017cszy przyk\u0142ad pobiera informacje o konfiguracji wstrzykiwania zale\u017cno\u015bci dla klasy <code>Magento\\Quote\\Model\\Quote\\Item\\ToOrderItem</code>:</p> <pre><code>    bin/magento dev:di:info \"Magento\\Quote\\Model\\Quote\\Item\\ToOrderItem\"\n</code></pre> Polecenie nie dzia\u0142a? <p>Je\u017celi po zapytaniu otrzyma\u0142e\u015b komunikat: <pre><code>DI configuration for the class MagentoQuoteModelQuoteItemToOrderItem in the GLOBAL area\n\nPreference: MagentoQuoteModelQuoteItemToOrderItem\n\nConstructor Parameters:\n\nIn ClassReader.php line 34:\n\n  Class \"MagentoQuoteModelQuoteItemToOrderItem\" does not exist\n\n\ndev:di:info &lt;class&gt;\n</code></pre> W zale\u017cno\u015bci od \u015brodowiska mo\u017ce by\u0107 konieczne u\u017cycie wi\u0119kszej liczby backslashy. <pre><code>    bin/magento dev:di:info \"Magento\\\\\\\\Quote\\\\\\\\Model\\\\\\\\Quote\\\\\\\\Item\\\\\\\\ToOrderItem\"\n</code></pre></p> <p>Przyk\u0142ad odpowiedzi:</p> <pre><code>    DI configuration for the class Magento\\Quote\\Model\\Quote\\Item\\ToOrderItem in the GLOBAL area\n\n    Preference: Magento\\Quote\\Model\\Quote\\Item\\ToOrderItem\n\n    Constructor Parameters:\n    +-------------------+--------------------------------------------------+------------------+\n    | Name              | Requested Type                                   | Configured Value |\n    +-------------------+--------------------------------------------------+------------------+\n    | orderItemFactory  | Magento\\Sales\\Api\\Data\\OrderItemInterfaceFactory |                  |\n    | objectCopyService | Magento\\Framework\\DataObject\\Copy                |                  |\n    | dataObjectHelper  | Magento\\Framework\\Api\\DataObjectHelper           |                  |\n    +-------------------+--------------------------------------------------+------------------+\n\n    Plugins:\n    +-----------------------------------------------------+---------+--------+\n    | Plugin                                              | Method  | Type   |\n    +-----------------------------------------------------+---------+--------+\n    | Magento\\Catalog\\Model\\Plugin\\QuoteItemProductOption | convert | before |\n    | Magento\\GiftMessage\\Model\\Plugin\\QuoteItem          | convert | after  |\n    | Magento\\Bundle\\Model\\Plugin\\QuoteItem               | convert | after  |\n    +-----------------------------------------------------+---------+--------+\n\n    Plugins for the Preference:\n    +-----------------------------------------------------+---------+--------+\n    | Plugin                                              | Method  | Type   |\n    +-----------------------------------------------------+---------+--------+\n    | Magento\\Catalog\\Model\\Plugin\\QuoteItemProductOption | convert | before |\n    | Magento\\GiftMessage\\Model\\Plugin\\QuoteItem          | convert | after  |\n    | Magento\\Bundle\\Model\\Plugin\\QuoteItem               | convert | after  |\n    +-----------------------------------------------------+---------+--------+\n</code></pre>"},{"location":"di/","title":"Czym jest Dependency Injection w Magento 2?","text":"<p>Dependency Injection (DI) to wzorzec projektowy, kt\u00f3ry polega na dostarczaniu obiektom zale\u017cno\u015bci zamiast pozwalania im na ich tworzenie. W praktyce oznacza to, \u017ce obiekty nie tworz\u0105 swoich zale\u017cno\u015bci, ale otrzymuj\u0105 je od zewn\u0119trznego \u017ar\u00f3d\u0142a. W ten spos\u00f3b obiekty s\u0105 od siebie odizolowane i mog\u0105 by\u0107 \u0142atwo testowane.</p> <p>Ka\u017cdy modu\u0142 mo\u017ce mie\u0107 globalny i specyficzny dla obszaru plik <code>di.xml</code>. Aplikacja odczytuje wszystkie pliki konfiguracyjne <code>di.xml</code> zadeklarowane w systemie i \u0142\u0105czy je wszystkie razem, dodaj\u0105c wszystkie w\u0119z\u0142y.</p> <p>Aplikacja wczytuje konfiguracj\u0119 w nast\u0119puj\u0105cych etapach:</p> <ul> <li>Initial (app/etc/di.xml)</li> <li>Global (/etc/di.xml) <li>Area-specific (/etc//di.xml) <p>Mamy do dyspozycji nast\u0119puj\u0105ce obszary:</p> <ul> <li>adminhtml</li> <li>frontend</li> <li>graphql</li> <li>webapi_rest</li> <li>webapi_soap</li> <li>crontab</li> </ul>"},{"location":"di/plugins/","title":"Pluginy","text":"<p>Aby rozszerzy\u0107 dzia\u0142anie klasy, mo\u017cesz u\u017cy\u0107 plugin\u00f3w. Pluginy to klasy, kt\u00f3re modyfikuj\u0105 zachowanie innych klas. W Magento 2 pluginy s\u0105 wykorzystywane do modyfikacji zachowania metod publicznych.</p> <p>Przy u\u017cyciu <code>di.xml</code> zdefiniujesz pluginy dla klas. <code>sortOrder</code> okre\u015bla kolejno\u015b\u0107 wywo\u0142ywania.  Mo\u017cesz tak\u017ce wy\u0142\u0105czy\u0107 plugin poprzez u\u017cycie parametru <code>disabled</code>.</p> <pre><code>        &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n        &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n                xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n            &lt;type name=\"{ObservedType}\"&gt;\n                &lt;plugin name=\"{pluginName}\" type=\"{PluginClassName}\" sortOrder=\"1\" disabled=\"false\" /&gt;\n            &lt;/type&gt;\n        &lt;/config&gt;\n</code></pre> <p>Wi\u0119cej informacji o pluginach znajdziesz w dokumentacji Magento.</p>"},{"location":"di/shared/","title":"Konfiguracja \u017cycia obiektu","text":"<p>Styl \u017cycia obiektu okre\u015bla liczb\u0119 instancji, kt\u00f3re mog\u0105 istnie\u0107 dla tego obiektu.</p> <p>Mo\u017cesz skonfigurowa\u0107 zale\u017cno\u015bci, aby mie\u0107 nast\u0119puj\u0105cy styl \u017cycia:</p> <ul> <li>Singleton (domy\u015blnie) \u2014 istnieje jedna instancja tej klasy. Mened\u017cer obiektu tworzy go na pierwsze \u017c\u0105danie. Ponowne \u017c\u0105danie klasy zwraca t\u0119 sam\u0105 instancj\u0119. Usuni\u0119cie lub zako\u0144czenie zarejestrowanego w nim kontenera zwalnia instancj\u0119.</li> <li>Przej\u015bciowe \u2014 mened\u017cer obiekt\u00f3w tworzy now\u0105 instancj\u0119 klasy dla ka\u017cdego \u017c\u0105dania.</li> </ul> <p><code>shared</code> okre\u015bla styl \u017cycia dla <code>type</code> oraz <code>argument</code>.</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n        &lt;type name=\"Magento\\Filesystem\" shared=\"false\"&gt;\n            &lt;arguments&gt;\n                &lt;argument name=\"adapter\" xsi:type=\"object\" shared=\"false\"&gt;Magento\\Filesystem\\Adapter\\Local&lt;/argument&gt;\n            &lt;/arguments&gt;\n        &lt;/type&gt;\n    &lt;/config&gt;\n</code></pre>"},{"location":"di/type_configuration/","title":"Konfigurowanie typ\u00f3w","text":"<p>Typ konfiguracji opisuje styl \u017cycia obiektu i spos\u00f3b jego instancjonowania.</p> <p>Mo\u017cesz skonfigurowa\u0107 typ w w\u0119\u017ale konfiguracji di.xml w nast\u0119puj\u0105cy spos\u00f3b:</p> <pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n    &lt;config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\"&gt;\n\n        &lt;virtualType name=\"moduleConfig\" type=\"Magento\\Core\\Model\\Config\"&gt;\n            &lt;arguments&gt;\n                &lt;argument name=\"type\" xsi:type=\"string\"&gt;system&lt;/argument&gt;\n            &lt;/arguments&gt;\n        &lt;/virtualType&gt;\n\n        &lt;type name=\"Magento\\Core\\Model\\App\"&gt;\n            &lt;arguments&gt;\n                &lt;argument name=\"config\" xsi:type=\"object\"&gt;moduleConfig&lt;/argument&gt;\n            &lt;/arguments&gt;\n        &lt;/type&gt;\n    &lt;/config&gt;\n</code></pre>"},{"location":"di/type_configuration/#typy-wirtualne","title":"Typy wirtualne","text":"<p>Typ wirtualny umo\u017cliwia zmian\u0119 konkretnych argument\u00f3w zale\u017cno\u015bci, kt\u00f3re mo\u017cna wstrzykiwa\u0107, a tak\u017ce zachowania okre\u015blonej klasy. W rezultacie mo\u017cna u\u017cywa\u0107 dostosowanej klasy bez wp\u0142ywu na inne klasy, kt\u00f3re s\u0105 zale\u017cne od orygina\u0142u.</p> <p>Przyk\u0142ad tworzy typ wirtualny dla <code>Magento\\Core\\Model\\Config</code> i identyfikuje system jako argument konstruktora dla typu.</p>"},{"location":"elasticsearch/commands/","title":"Przydatne polecenia","text":""},{"location":"elasticsearch/commands/#wejscie-w-bash-kontenera-z-redis","title":"Wej\u015bcie w bash kontenera z Redis","text":"<p>U\u017cywaj\u0105c terminala sprawd\u017a nazw\u0119 kontenera:</p> <pre><code>docker ps\n</code></pre> <p>Wej\u015bcie w bash redisa</p> <pre><code>docker exec -ti magento246_redis bash\n</code></pre>"},{"location":"elasticsearch/commands/#dostepne-narzedzia","title":"Dost\u0119pne narz\u0119dzia","text":"<p>Redis oferuje tryb monitorowania, kt\u00f3ry pozwala zobaczy\u0107 wszystkie polecenia przychodz\u0105ce do serwera w czasie rzeczywistym:</p> <pre><code>redis-cli monitor\n</code></pre> <p>Uruchom t\u0119 komend\u0119 i przegl\u0105daj stron\u0119 Magento. Powiniene\u015b zobaczy\u0107 aktywno\u015b\u0107 Redis, co oznacza, \u017ce Magento korzysta z Redis do cache'owania.</p>"},{"location":"elasticsearch/configuration/","title":"Konfiguracja","text":""},{"location":"elasticsearch/configuration/#docker_composeyml","title":"docker_compose.yml","text":"<p>W swoim pliku <code>docker_compose.yml</code> dodaj Elasticsearch jako us\u0142ug\u0119.</p> Przyk\u0142ad konfiguracji pliku <code>docker_compose.yml</code> YML <pre><code>version: '3.5'\nservices:\n  elasticsearch:\n    build: .\n    container_name: ${PROJECT_PREFIX}_elasticsearch\n    environment:\n      - xpack.security.enabled=false\n      - discovery.type=single-node\n    ports:\n      - 9200:9200\n    volumes:\n      - demo_esdata:/usr/share/elasticsearch/data:rw\n\nvolumes:\n  demo_esdata:\n    driver: local\n</code></pre>"},{"location":"elasticsearch/","title":"Czym jest Elasticsearch?","text":"<p>Elasticsearch to wyszukiwarka i analityczne narz\u0119dzie open-source oparte na silniku Apache Lucene.  Jest zaprojektowane do pracy w czasie rzeczywistym, co sprawia, \u017ce jest bardzo szybkie i wydajne.</p> <p>Kluczowe cechy Elasticsearch:</p> <ol> <li> <p>Wyszukiwanie pe\u0142notekstowe:</p> <p>Elasticsearch jest doskona\u0142y do przeszukiwania du\u017cych zbior\u00f3w danych, dzi\u0119ki zaawansowanym funkcjom wyszukiwania pe\u0142notekstowego.</p> </li> <li> <p>Skalowalno\u015b\u0107:</p> <p>Mo\u017ce obs\u0142ugiwa\u0107 ogromne ilo\u015bci danych, dzia\u0142aj\u0105c w klastrze, gdzie dane s\u0105 rozpraszane na wiele serwer\u00f3w.</p> </li> <li> <p>Analityka czasu rzeczywistego:</p> <p>Umo\u017cliwia analizowanie danych w czasie rzeczywistym, co jest przydatne do monitorowania, log\u00f3w czy analizy biznesowej.</p> </li> <li> <p>API RESTful:</p> <p>Elasticsearch udost\u0119pnia interfejs API REST, co umo\u017cliwia \u0142atw\u0105 integracj\u0119 z innymi aplikacjami.</p> </li> <li> <p>Indeksowanie:</p> <p>Dane s\u0105 indeksowane, co przyspiesza wyszukiwanie i zapytania.</p> </li> </ol> <p>Do wizualizacji danych w Elasticsearch, u\u017cywa sie narz\u0119dzia Kibana.</p>"},{"location":"elasticsearch/working_test/","title":"Sprawdzenie dzia\u0142ania","text":"<p>Sprawd\u017a po\u0142\u0105czenie z Elasticsearch, u\u017cywaj\u0105c narz\u0119dzia <code>curl</code>:</p> <pre><code>curl -X GET http://127.0.0.1:9200\n</code></pre> <p>To polecenie sprawdza, czy serwer Elasticsearch jest dost\u0119pny i odpowiada na \u017c\u0105dania. Je\u015bli wszystko jest w porz\u0105dku, otrzymasz odpowied\u017a HTTP 200.</p>"},{"location":"redis/commands/","title":"Przydatne polecenia","text":""},{"location":"redis/commands/#wejscie-w-bash-kontenera-z-redis","title":"Wej\u015bcie w bash kontenera z Redis","text":"<p>U\u017cywaj\u0105c terminala sprawd\u017a nazw\u0119 kontenera:</p> <pre><code>docker ps\n</code></pre> <p>Wej\u015bcie w bash redisa</p> <pre><code>docker exec -ti magento246_redis bash\n</code></pre>"},{"location":"redis/commands/#dostepne-narzedzia","title":"Dost\u0119pne narz\u0119dzia","text":"<p>Redis oferuje tryb monitorowania, kt\u00f3ry pozwala zobaczy\u0107 wszystkie polecenia przychodz\u0105ce do serwera w czasie rzeczywistym:</p> <pre><code>redis-cli monitor\n</code></pre> <p>Uruchom t\u0119 komend\u0119 i przegl\u0105daj stron\u0119 Magento. Powiniene\u015b zobaczy\u0107 aktywno\u015b\u0107 Redis, co oznacza, \u017ce Magento korzysta z Redis do cache'owania.</p>"},{"location":"redis/configuration/","title":"Konfiguracja","text":""},{"location":"redis/configuration/#docker_composeyml","title":"docker_compose.yml","text":"<p>W swoim pliku <code>docker_compose.yml</code> dodaj Redis jako us\u0142ug\u0119.</p> Przyk\u0142ad konfiguracji pliku <code>docker_compose.yml</code> YML <pre><code>version: '3.5'\nservices:\n  redis:\n    image: redis:latest\n    container_name: ${PROJECT_PREFIX}_redis\n    restart: always\n    ports:\n      - '6379:6379'\n    volumes:\n      - redis_data:/data\n\nvolumes:\n    redis_data:\n      driver: local\n</code></pre>"},{"location":"redis/configuration/#appetcenvphp","title":"app/etc/env.php","text":"<p>Skonfiguruj Magento aby u\u017cywa\u0142o Redis poprzez edycj\u0119 pliku <code>app/etc/env.php</code>.</p> Przyk\u0142ad konfiguracji pliku <code>app/etc/env.php</code> PHP <pre><code>&lt;?php\nreturn [\n    'backend' =&gt; [\n        'frontName' =&gt; 'epanel746'\n    ],\n    'cache' =&gt; [\n        'graphql' =&gt; [\n            'id_salt' =&gt; '37qPIkTyjhhb3l1uMG0sm9Ssy146KkeH'\n        ],\n        'frontend' =&gt; [\n            'default' =&gt; [\n                'backend' =&gt; 'Cm_Cache_Backend_Redis',\n                'backend_options' =&gt; [\n                    'server' =&gt; 'redis',\n                    'port' =&gt; '6379',\n                    'persistent' =&gt; '', // Specify a unique string like \"cache-db0\" to enable persistent connections.\n                    'database' =&gt; '1',\n                    'password' =&gt; ''\n                ],\n                'id_prefix' =&gt; '7bf_'\n            ],\n            'page_cache' =&gt; [\n                'id_prefix' =&gt; '7bf_',\n                'backend' =&gt; 'Cm_Cache_Backend_Redis',\n                'backend_options' =&gt; [\n                    'server' =&gt; 'redis',\n                    'port' =&gt; '6379',\n                    'persistent' =&gt; '', // Specify a unique string like \"cache-db0\" to enable persistent connections.\n                    'database' =&gt; '0', // Separate database 1 to keep FPC separately\n                    'password' =&gt; '',\n//                    'force_standalone' =&gt; '0', // 0 for phpredis, 1 for standalone PHP\n//                    'connect_retries' =&gt; '1', // Reduces errors due to random connection failures\n                    'lifetimelimit' =&gt; '57600', // 16 hours of lifetime for cache record\n                    'compress_data' =&gt; '0' // DISABLE compression for EE FPC since it already uses compression\n                ]\n            ]\n        ],\n        'allow_parallel_generation' =&gt; false\n    ],\n    'remote_storage' =&gt; [\n        'driver' =&gt; 'file'\n    ],\n    'queue' =&gt; [\n        'consumers_wait_for_messages' =&gt; 1\n    ],\n    'crypt' =&gt; [\n        'key' =&gt; 'e8da5314a3a0b8db22da3d729fb3f42a'\n    ],\n    'db' =&gt; [\n        'table_prefix' =&gt; '',\n        'connection' =&gt; [\n            'default' =&gt; [\n                'host' =&gt; 'db',\n                'dbname' =&gt; 'magento246',\n                'username' =&gt; 'root',\n                'password' =&gt; 'password',\n                'model' =&gt; 'mysql4',\n                'engine' =&gt; 'innodb',\n                'initStatements' =&gt; 'SET NAMES utf8;',\n                'active' =&gt; '1',\n                'driver_options' =&gt; [\n                    1014 =&gt; false\n                ]\n            ]\n        ]\n    ],\n    'resource' =&gt; [\n        'default_setup' =&gt; [\n            'connection' =&gt; 'default'\n        ]\n    ],\n    'x-frame-options' =&gt; 'SAMEORIGIN',\n    'MAGE_MODE' =&gt; 'developer',\n    'session' =&gt; [\n        'save' =&gt; 'redis',\n        'redis' =&gt; [\n            'host' =&gt; 'redis',\n            'port' =&gt; '6379',\n            'password' =&gt; '',\n            'timeout' =&gt; '2.5',\n            'persistent_identifier' =&gt; '',\n            'database' =&gt; '0'\n        ]\n    ],\n    'lock' =&gt; [\n        'provider' =&gt; 'db'\n    ],\n    'directories' =&gt; [\n        'document_root_is_pub' =&gt; true\n    ],\n    'cache_types' =&gt; [\n        'config' =&gt; 1,\n        'layout' =&gt; 1,\n        'block_html' =&gt; 1,\n        'collections' =&gt; 1,\n        'reflection' =&gt; 1,\n        'db_ddl' =&gt; 1,\n        'compiled_config' =&gt; 1,\n        'eav' =&gt; 1,\n        'customer_notification' =&gt; 1,\n        'config_integration' =&gt; 1,\n        'config_integration_api' =&gt; 1,\n        'full_page' =&gt; 1,\n        'config_webservice' =&gt; 1,\n        'translate' =&gt; 1\n    ],\n    'downloadable_domains' =&gt; [\n        'magento.localhost',\n        'youtube.com'\n    ],\n    'install' =&gt; [\n        'date' =&gt; 'Mon, 25 Mar 2024 08:55:32 +0000'\n    ]\n];\n</code></pre>"},{"location":"redis/","title":"Czym jest Redis?","text":"<p>W Magento Redis jest u\u017cywany g\u0142\u00f3wnie do trzech cel\u00f3w:</p> <ol> <li> <p>Caching (buforowanie):</p> <p>Redis jest u\u017cywany jako backend do r\u00f3\u017cnych typ\u00f3w pami\u0119ci podr\u0119cznych w Magento, takich jak pami\u0119\u0107 podr\u0119czna stron, blok\u00f3w, uk\u0142ad\u00f3w, t\u0142umacze\u0144 i pami\u0119ci podr\u0119cznej kolekcji. U\u017cycie Redis jako systemu buforowania zwi\u0119ksza wydajno\u015b\u0107 witryny, redukuj\u0105c liczb\u0119 \u017c\u0105da\u0144 do bazy danych i czasu \u0142adowania strony. Redis jest szczeg\u00f3lnie efektywny, poniewa\u017c przechowuje dane w pami\u0119ci (RAM), co umo\u017cliwia szybki dost\u0119p do danych.</p> </li> <li> <p>Session Storage (przechowywanie sesji):</p> <p>Magento u\u017cywa Redis do przechowywania sesji u\u017cytkownik\u00f3w. W przypadku aplikacji internetowych z du\u017cym ruchem, zarz\u0105dzanie sesjami jest kluczowe dla skalowalno\u015bci i wydajno\u015bci. Redis oferuje szybki dost\u0119p do danych sesji i umo\u017cliwia \u0142atwe skalowanie, co jest wa\u017cne w przypadku rozproszonego \u015brodowiska serwerowego.</p> </li> <li> <p>Full Page Cache (FPC):</p> <p>Redis mo\u017ce by\u0107 u\u017cywany jako backend dla pe\u0142nej pami\u0119ci podr\u0119cznej stron (FPC) w Magento. FPC przechowuje pe\u0142ne renderowane strony HTML w pami\u0119ci podr\u0119cznej, dzi\u0119ki czemu nie trzeba ich generowa\u0107 od zera przy ka\u017cdym \u017c\u0105daniu. To znacz\u0105co poprawia szybko\u015b\u0107 \u0142adowania stron dla u\u017cytkownik\u00f3w, zw\u0142aszcza przy du\u017cym ruchu.</p> </li> </ol>"},{"location":"redis/working_test/","title":"Sprawdzenie dzia\u0142ania","text":"<p>Zlokalizuj nazw\u0119 kontenera z Redisem:</p> <pre><code>docker ps\n</code></pre> <p>W wejd\u017a do kontenera z redisem:</p> <pre><code>docker exec -ti magento246_redis bash\n</code></pre> <p>Upewnij si\u0119, \u017ce Redis dzia\u0142a i Magento mo\u017ce si\u0119 z nim po\u0142\u0105czy\u0107. Mo\u017cesz u\u017cy\u0107 narz\u0119dzia redis-cli:</p> <pre><code>redis-cli ping\n</code></pre> <p>Oczekiwany wynik to <code>PONG</code>, co oznacza, \u017ce Redis dzia\u0142a poprawnie.</p>"},{"location":"varnish/commands/","title":"Przydatne polecenia","text":""},{"location":"varnish/commands/#wejscie-w-bash-kontenera-varnisha","title":"Wej\u015bcie w bash kontenera varnisha","text":"<p>U\u017cywaj\u0105c terminala sprawd\u017a nazw\u0119 kontenera varnisha <pre><code>docker ps\n</code></pre></p> <p>Wej\u015bcie w bash varnisha</p> <pre><code>docker exec -ti magento246_varnish bash\n</code></pre>"},{"location":"varnish/commands/#dostepne-narzedzia","title":"Dost\u0119pne narz\u0119dzia","text":""},{"location":"varnish/commands/#varnishlog","title":"varnishlog","text":"<p>Pozwala na przegl\u0105danie log\u00f3w varnisha w czasie rzeczywistym.</p> <pre><code>varnishlog\n</code></pre>"},{"location":"varnish/commands/#varnishadm","title":"varnishadm","text":"<p>To narz\u0119dzie wiersza polece\u0144 do zarz\u0105dzania serwerem Varnish Cache. Umo\u017cliwia administratorom i u\u017cytkownikom Varnish interakcj\u0119 z serwerem Varnish poprzez wysy\u0142anie polece\u0144 administracyjnych. Mo\u017cna go u\u017cywa\u0107 do wykonywania r\u00f3\u017cnych zada\u0144, takich jak czyszczenie cache, \u0142adowanie i weryfikowanie plik\u00f3w konfiguracyjnych VCL (Varnish Configuration Language), monitorowanie stanu serwera i wiele innych. <pre><code>varnishadm\n</code></pre></p>"},{"location":"varnish/commands/#varnishstat","title":"varnishstat","text":"<p>To narz\u0119dzie wiersza polece\u0144 s\u0142u\u017c\u0105ce do monitorowania i wy\u015bwietlania statystyk serwera Varnish Cache w czasie rzeczywistym. Dostarcza szczeg\u00f3\u0142owe informacje o dzia\u0142aniu serwera, takie jak liczba \u017c\u0105da\u0144, cache hits, cache misses, wykorzystanie pami\u0119ci i inne wska\u017aniki wydajno\u015bci. <pre><code>varnishstat\n</code></pre></p>"},{"location":"varnish/commands/#varnishlist","title":"varnishlist","text":"<p>Varnishlist pozwala na zbieranie i wizualizacj\u0119 danych dotycz\u0105cych czasu odpowiedzi, op\u00f3\u017anie\u0144, trafie\u0144 i miss\u00f3w w cache. Umo\u017cliwia to identyfikowanie w\u0105skich garde\u0142 i problem\u00f3w z wydajno\u015bci\u0105. <pre><code>varnishlist\n</code></pre></p>"},{"location":"varnish/commands/#czyszczenie-cache","title":"Czyszczenie cache","text":"<p>Aby wyczy\u015bci\u0107 cache varnisha, nale\u017cy wys\u0142a\u0107 zapytanie <code>PURGE</code> na adres URL, kt\u00f3ry chcemy wyczy\u015bci\u0107.</p> <p>U\u017cywaj\u0105c terminala wprowad\u017a polecenie: <pre><code> curl -X PURGE -H 'X-Magento-Tags-Pattern: .*' http://domena.local\n</code></pre></p>"},{"location":"varnish/configuration/","title":"Konfiguracja","text":""},{"location":"varnish/configuration/#docker_composeyml","title":"docker_compose.yml","text":"<p>W swoim pliku <code>docker_compose.yml</code> dodaj Varnish jako us\u0142ug\u0119.</p> Uwaga <p>Upewnij si\u0119, \u017ce us\u0142uga Varnish nas\u0142uchuje na porcie <code>80:80</code>. Aby to tutaj przychodzi\u0142y zapytania przegl\u0105darki.</p> Uwaga <p>Ustaw nas\u0142uchiwanie nginx na port <code>8080:8080</code>.</p> Przyk\u0142ad konfiguracji pliku <code>docker_compose.yml</code> YML <pre><code>version: '3.5'\nservices:\n  varnish:\n    image: varnish:stable\n    container_name: ${PROJECT_PREFIX}_varnish\n    volumes:\n      - ./varnish/default.vcl:/etc/varnish/default.vcl\n    ports:\n      - \"80:80\"\n    environment:\n      - VARNISH_SIZE=2G\n    links:\n      - nginx\n\n  nginx:\n    image: nginx:latest\n    container_name: ${PROJECT_PREFIX}_nginx\n    ports:\n      - \"8080:8080\"\n      - 443:443\n    volumes:\n      - ${PROJECT_PATH}:${PROJECT_PATH}\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf\n      - ./nginx/magento.nginx.conf:/etc/nginx/magento.nginx.conf\n      - ./nginx/sites:/etc/nginx/conf.d/\n      - ./certs:/etc/nginx/certs/\n    links:\n      - php\n      - php_xdebug\n</code></pre>"},{"location":"varnish/configuration/#varnishdefaultvcl","title":"varnish/default.vcl","text":"<p>W katalogu dockera <code>varnish</code> utw\u00f3rz plik <code>default.vcl</code> z konfiguracj\u0105 Varnish.</p> <p>Konfiguracj\u0119 mo\u017cesz wygenerowa\u0107 przez Panel Administracyjny Magento 2.  Wchodzisz w <code>Stores</code> -&gt; <code>Configuration</code> -&gt; <code>Advanced</code> -&gt; <code>System</code> -&gt; <code>Full Page Cache</code> -&gt; <code>Varnish Configuration</code>  i klikasz <code>Export VCL for Varnish 5</code>.</p> Uwaga <p>Ustaw backend varnisha na <code>nginx</code> port <code>8080:8080</code>.</p> Uwaga <p>Aby umo\u017cliwi\u0107 czyszczenie ustaw <code>acl purge</code> oraz <code>req.method == \"PURGE\"</code>.</p> Przyk\u0142ad konfiguracji pliku <code>default.yml</code> VCL <pre><code># VCL version 5.0 is not supported so it should be 4.0 even though actually used Varnish version is 6\nvcl 4.1;\n\nimport std;\n# The minimal Varnish version is 6.0\n# For SSL offloading, pass the following header in your proxy server or load balancer: 'X-Forwarded-Proto: https'\n\nbackend default {\n    .host = \"nginx\";\n    .port = \"8080\";\n    .first_byte_timeout = 600s;\n    .probe = {\n        .url = \"/health_check.php\";\n        .timeout = 2s;\n        .interval = 5s;\n        .window = 10;\n        .threshold = 5;\n   }\n}\n\nacl purge {\n    \"localhost\";\n    \"127.0.0.1\";\n    \"nginx\";\n}\n\nsub vcl_recv {\n    if (req.restarts &gt; 0) {\n        set req.hash_always_miss = true;\n    }\n\n    if (req.method == \"PURGE\") {\n        if (client.ip !~ purge) {\n            #return (synth(405, \"Method not allowed\"));\n        }\n        # To use the X-Pool header for purging varnish during automated deployments, make sure the X-Pool header\n        # has been added to the response in your backend server config. This is used, for example, by the\n        # capistrano-magento2 gem for purging old content from varnish during it's deploy routine.\n        if (!req.http.X-Magento-Tags-Pattern &amp;&amp; !req.http.X-Pool) {\n            return (synth(400, \"X-Magento-Tags-Pattern or X-Pool header required\"));\n        }\n        if (req.http.X-Magento-Tags-Pattern) {\n          ban(\"obj.http.X-Magento-Tags ~ \" + req.http.X-Magento-Tags-Pattern);\n        }\n        if (req.http.X-Pool) {\n          ban(\"obj.http.X-Pool ~ \" + req.http.X-Pool);\n        }\n        return (synth(200, \"Purged\"));\n    }\n\n    if (req.method != \"GET\" &amp;&amp;\n        req.method != \"HEAD\" &amp;&amp;\n        req.method != \"PUT\" &amp;&amp;\n        req.method != \"POST\" &amp;&amp;\n        req.method != \"TRACE\" &amp;&amp;\n        req.method != \"OPTIONS\" &amp;&amp;\n        req.method != \"DELETE\") {\n          /* Non-RFC2616 or CONNECT which is weird. */\n          return (pipe);\n    }\n\n    # We only deal with GET and HEAD by default\n    if (req.method != \"GET\" &amp;&amp; req.method != \"HEAD\") {\n        return (pass);\n    }\n\n    # Bypass customer, shopping cart, checkout\n    if (req.url ~ \"/customer\" || req.url ~ \"/checkout\") {\n        return (pass);\n    }\n\n    # Bypass health check requests\n    if (req.url ~ \"^/(pub/)?(health_check.php)$\") {\n        return (pass);\n    }\n\n    # Set initial grace period usage status\n    set req.http.grace = \"none\";\n\n    # normalize url in case of leading HTTP scheme and domain\n    set req.url = regsub(req.url, \"^http[s]?://\", \"\");\n\n    # collect all cookies\n    std.collect(req.http.Cookie);\n\n    # Compression filter. See https://www.varnish-cache.org/trac/wiki/FAQ/Compression\n    if (req.http.Accept-Encoding) {\n        if (req.url ~ \"\\.(jpg|jpeg|png|gif|gz|tgz|bz2|tbz|mp3|ogg|swf|flv)$\") {\n            # No point in compressing these\n            unset req.http.Accept-Encoding;\n        } elsif (req.http.Accept-Encoding ~ \"gzip\") {\n            set req.http.Accept-Encoding = \"gzip\";\n        } elsif (req.http.Accept-Encoding ~ \"deflate\" &amp;&amp; req.http.user-agent !~ \"MSIE\") {\n            set req.http.Accept-Encoding = \"deflate\";\n        } else {\n            # unknown algorithm\n            unset req.http.Accept-Encoding;\n        }\n    }\n\n    # Remove all marketing get parameters to minimize the cache objects\n    if (req.url ~ \"(\\?|&amp;)(gclid|cx|ie|cof|siteurl|zanpid|origin|fbclid|mc_[a-z]+|utm_[a-z]+|_bta_[a-z]+)=\") {\n        set req.url = regsuball(req.url, \"(gclid|cx|ie|cof|siteurl|zanpid|origin|fbclid|mc_[a-z]+|utm_[a-z]+|_bta_[a-z]+)=[-_A-z0-9+()%.]+&amp;?\", \"\");\n        set req.url = regsub(req.url, \"[?|&amp;]+$\", \"\");\n    }\n\n    # Static files caching\n    if (req.url ~ \"^/(pub/)?(media|static)/\") {\n        # Static files should not be cached by default\n        return (pass);\n\n        # But if you use a few locales and don't use CDN you can enable caching static files by commenting previous line (#return (pass);) and uncommenting next 3 lines\n        #unset req.http.Https;\n        #unset req.http.X-Forwarded-Proto;\n        #unset req.http.Cookie;\n    }\n\n    # Bypass authenticated GraphQL requests without a X-Magento-Cache-Id\n    if (req.url ~ \"/graphql\" &amp;&amp; !req.http.X-Magento-Cache-Id &amp;&amp; req.http.Authorization ~ \"^Bearer\") {\n        return (pass);\n    }\n\n    return (hash);\n}\n\nsub vcl_hash {\n    if ((req.url !~ \"/graphql\" || !req.http.X-Magento-Cache-Id) &amp;&amp; req.http.cookie ~ \"X-Magento-Vary=\") {\n        hash_data(regsub(req.http.cookie, \"^.*?X-Magento-Vary=([^;]+);*.*$\", \"\\1\"));\n    }\n\n    # To make sure http users don't see ssl warning\n    if (req.http.X-Forwarded-Proto) {\n        hash_data(req.http.X-Forwarded-Proto);\n    }\n\n\n    if (req.url ~ \"/graphql\") {\n        call process_graphql_headers;\n    }\n}\n\nsub process_graphql_headers {\n    if (req.http.X-Magento-Cache-Id) {\n        hash_data(req.http.X-Magento-Cache-Id);\n\n        # When the frontend stops sending the auth token, make sure users stop getting results cached for logged-in users\n        if (req.http.Authorization ~ \"^Bearer\") {\n            hash_data(\"Authorized\");\n        }\n    }\n\n    if (req.http.Store) {\n        hash_data(req.http.Store);\n    }\n\n    if (req.http.Content-Currency) {\n        hash_data(req.http.Content-Currency);\n    }\n}\n\nsub vcl_backend_response {\n\n    set beresp.grace = 3d;\n\n    if (beresp.http.content-type ~ \"text\") {\n        set beresp.do_esi = true;\n    }\n\n    if (bereq.url ~ \"\\.js$\" || beresp.http.content-type ~ \"text\") {\n        set beresp.do_gzip = true;\n    }\n\n    if (beresp.http.X-Magento-Debug) {\n        set beresp.http.X-Magento-Cache-Control = beresp.http.Cache-Control;\n    }\n\n    # cache only successfully responses and 404s that are not marked as private\n    if (beresp.status != 200 &amp;&amp;\n            beresp.status != 404 &amp;&amp;\n            beresp.http.Cache-Control ~ \"private\") {\n        set beresp.uncacheable = true;\n        set beresp.ttl = 86400s;\n        return (deliver);\n    }\n\n    # validate if we need to cache it and prevent from setting cookie\n    if (beresp.ttl &gt; 0s &amp;&amp; (bereq.method == \"GET\" || bereq.method == \"HEAD\")) {\n        unset beresp.http.set-cookie;\n    }\n\n   # If page is not cacheable then bypass varnish for 2 minutes as Hit-For-Pass\n   if (beresp.ttl &lt;= 0s ||\n       beresp.http.Surrogate-control ~ \"no-store\" ||\n       (!beresp.http.Surrogate-Control &amp;&amp;\n       beresp.http.Cache-Control ~ \"no-cache|no-store\") ||\n       beresp.http.Vary == \"*\") {\n        # Mark as Hit-For-Pass for the next 2 minutes\n        set beresp.ttl = 120s;\n        set beresp.uncacheable = true;\n   }\n\n   # If the cache key in the Magento response doesn't match the one that was sent in the request, don't cache under the request's key\n   if (bereq.url ~ \"/graphql\" &amp;&amp; bereq.http.X-Magento-Cache-Id &amp;&amp; bereq.http.X-Magento-Cache-Id != beresp.http.X-Magento-Cache-Id) {\n      set beresp.ttl = 0s;\n      set beresp.uncacheable = true;\n   }\n\n    return (deliver);\n}\n\nsub vcl_deliver {\n    if (resp.http.x-varnish ~ \" \") {\n        set resp.http.X-Magento-Cache-Debug = \"HIT\";\n        set resp.http.Grace = req.http.grace;\n    } else {\n        set resp.http.X-Magento-Cache-Debug = \"MISS\";\n    }\n\n    # Not letting browser to cache non-static files.\n    if (resp.http.Cache-Control !~ \"private\" &amp;&amp; req.url !~ \"^/(pub/)?(media|static)/\") {\n        set resp.http.Pragma = \"no-cache\";\n        set resp.http.Expires = \"-1\";\n        set resp.http.Cache-Control = \"no-store, no-cache, must-revalidate, max-age=0\";\n    }\n\n    if (!resp.http.X-Magento-Debug) {\n        unset resp.http.Age;\n    }\n    unset resp.http.X-Magento-Debug;\n    unset resp.http.X-Magento-Tags;\n    unset resp.http.X-Powered-By;\n    unset resp.http.Server;\n    unset resp.http.X-Varnish;\n    unset resp.http.Via;\n    unset resp.http.Link;\n}\n\nsub vcl_hit {\n    if (obj.ttl &gt;= 0s) {\n        # Hit within TTL period\n        return (deliver);\n    }\n    if (std.healthy(req.backend_hint)) {\n        if (obj.ttl + 300s &gt; 0s) {\n            # Hit after TTL expiration, but within grace period\n            set req.http.grace = \"normal (healthy server)\";\n            return (deliver);\n        } else {\n            # Hit after TTL and grace expiration\n            return (restart);\n        }\n    } else {\n        # server is not healthy, retrieve from cache\n        set req.http.grace = \"unlimited (unhealthy server)\";\n        return (deliver);\n    }\n}\n</code></pre>"},{"location":"varnish/configuration/#nginxsiteswebsiteconf","title":"nginx/sites/website.conf","text":"<p>W katalogu dockera <code>nginx</code> utw\u00f3rz plik <code>website.conf</code> z konfiguracj\u0105 serwera nginx.</p> Uwaga <p>Skonfiguruj nas\u0142uchiwanie na port <code>8080</code>. </p> Przyk\u0142ad konfiguracji pliku <code>website.conf</code> CONF <pre><code>map $cookie_XDEBUG_SESSION $phpserver {\n   default magento246_php:9000;\n   xdebug magento246_php_xdebug:9000;\n}\n\nserver {\n   listen 8080;\n   server_name magento.localhost;\n   ssl_certificate     /etc/nginx/certs/nginx.crt;\n   ssl_certificate_key /etc/nginx/certs/nginx.key;\n   set $MAGE_ROOT /home/aurora/workspace/magento246;\n   set $MAGE_RUN_TYPE website; #or set $MAGE_RUN_TYPE store;\n   set $MAGE_RUN_CODE base;\n\n   add_header Strict-Transport-Security \"max-age=63072000\" always;\n\n   location / {\n       include /etc/nginx/magento.nginx.conf;\n   }\n}\n\nserver {\n   listen 443 ssl http2;\n   server_name magento.localhost;\n   ssl_certificate     /etc/nginx/certs/nginx.crt;\n   ssl_certificate_key /etc/nginx/certs/nginx.key;\n   set $MAGE_ROOT /home/aurora/workspace/magento246;\n   set $MAGE_RUN_TYPE website; #or set $MAGE_RUN_TYPE store;\n   set $MAGE_RUN_CODE base;\n\n   add_header Strict-Transport-Security \"max-age=63072000\" always;\n\n   location / {\n       include /etc/nginx/magento.nginx.conf;\n   }\n}\n</code></pre>"},{"location":"varnish/configuration/#magento-2","title":"Magento 2","text":"<p>W Panelu Administracyjnym Magento 2 przejd\u017a do <code>Stores</code> -&gt; <code>Configuration</code> -&gt; <code>Advanced</code> -&gt; <code>System</code> -&gt; <code>Full Page Cache</code> -&gt; <code>Caching Application</code> i ustaw <code>Varnish Cache</code>.</p>"},{"location":"varnish/configuration/#etchosts","title":"/etc/hosts","text":"<p>Upewnij si\u0119, \u017ce wpis do pliku <code>/etc/hosts</code> kieruje domen\u0119 na lokalny adres IP <code>127.0.0.1</code>.</p>"},{"location":"varnish/","title":"Czym jest Varnish?","text":"<p>Varnish w Magento 2 pe\u0142ni rol\u0119 zaawansowanego systemu cache'owania, kt\u00f3ry przyspiesza czas \u0142adowania strony i odci\u0105\u017ca serwer aplikacji. Dzia\u0142a jako proxy odwrotne (reverse proxy), przechowuj\u0105c kopie stron HTML w pami\u0119ci podr\u0119cznej i serwuj\u0105c je bezpo\u015brednio u\u017cytkownikom, zamiast ka\u017cdorazowo generowa\u0107 je z Magento. Varnish obs\u0142uguje r\u00f3wnie\u017c nag\u0142\u00f3wki HTTP i regu\u0142y cache'owania, co umo\u017cliwia precyzyjne zarz\u0105dzanie tym, co i kiedy jest przechowywane w cache. Dzi\u0119ki Varnishowi Magento 2 mo\u017ce obs\u0142ugiwa\u0107 wi\u0119ksz\u0105 liczb\u0119 jednoczesnych u\u017cytkownik\u00f3w, poprawiaj\u0105c wydajno\u015b\u0107 i skalowalno\u015b\u0107 sklepu internetowego.</p>"},{"location":"varnish/working_test/","title":"Sprawdzenie dzia\u0142ania","text":"<ol> <li>W terminalu uruchom komend\u0119 <code>curl -I http://domena.local</code> lub wejd\u017a na stron\u0119 <code>http://domena.local</code> w przegl\u0105darce.</li> <li>W odpowiedzi zobaczysz nag\u0142\u00f3wek <code>X-Magento-Cache-Debug</code> z informacj\u0105 o cache'owaniu:<ul> <li><code>HIT</code> - strona zosta\u0142a zwr\u00f3cona z cache.</li> <li><code>MISS</code> - strona zosta\u0142a zwr\u00f3cona z serwera.</li> </ul> </li> </ol>"}]}